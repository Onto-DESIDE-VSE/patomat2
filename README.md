# PatOMat2

![Publish Backend Docker image](https://github.com/Onto-DESIDE-VSE/patomat2/actions/workflows/publish-backend.yml/badge.svg)
![Publish Frontend Docker image](https://github.com/Onto-DESIDE-VSE/patomat2/actions/workflows/publish-frontend.yml/badge.svg)
[![Javadoc](https://img.shields.io/badge/JavaDoc-Online-green)](https://Onto-DESIDE-VSE.github.io/patomat2/)

PatOMat2 is a tool for automatic searching for and processing of patterns in ontologies. It is an evolution of the
original [PatOMat](https://patomat.vse.cz/).

## Development

Requirements:

- Java 21 or later
- Apache Maven 3.x
- Node 18 or later

The application is split into `backend` written in Java and using Spring Boot and `frontend` written in TypeScript,
using Vue.js and built by Vite.

The backend can be started by going into the `backend` directory and calling `mvn spring-boot:run`. It starts a web
application
listening on port 8080.

The frontend can be started by going into the `frontend` directory and calling `npm run dev`. This starts the `Vite`
development
server on port 5173.

Cross-Origin Resource Sharing (CORS) is used to ensure frontend can communicate with backend. It is pre-configured to
the
frontend default URL (http://localhost:5173). If you need to change it, do so
in `backend/src/main/resources/application.yml`.

### Resources

PatOMat2 uses several language related sources:

- `backend/src/main/resources/irregular-verbs.csv` - list of irregular English verbs together with their past and past
  participle. Used by the `PassivizeFunction`. This file was generated by [ChatGPT](https://chatgpt.com/).
- `backend/src/main/resources/morphosemantic-links.csv` - table of morphosemantic links connecting verbs to nouns based
  on shared underlying meaning. It is an export of
  the [Morphosemantic Database standoff file](https://wordnet.princeton.edu/download/standoff-files) of WordNet
  available [here](https://wordnetcode.princeton.edu/standoff-files/morphosemantic-links.xls).

## Deployment

The application can be deployed using Docker Compose. The following parameters can be configured:

| Parameter                    | Default value                  | Description                                                                                                                                                                                                                                                      |
|:-----------------------------|:-------------------------------|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `ROOT`                       | `/patomat2`                    | Context path at which the application should be available.                                                                                                                                                                                                       |
| `HOST_PORT`                  | `1234`                         | Port at which the application should be available to the host system.                                                                                                                                                                                            |
| `PUBLIC_URL`                 | `http://localhost:1234`        | **Public** URL at which the application is running, without the context path (`ROOT`).                                                                                                                                                                           |
| `PUBLIC_PORT`                | `''`                           | **Public** port at which the application is running. Use only if the application is not available at the default 80 (HTTP) or 443 (HTTPS) port. If the application is running behind a regular server proxy, do not set this variable and just use `PUBLIC_URL`. |
| `NEW_ENTITY_IRI_BASE`        | `https://owl.vse.cz/patomat2/` | Default IRI base for new entities in case PatOMat2 is unable to get ontology IRI.                                                                                                                                                                                |
| `MAX_SESSIONS`               | `20`                           | Maximum number of concurrent sessions allowed by the application. Any more requests will be rejected until a session is closed.                                                                                                                                  |
| `PATOMAT2_EXAMPLES_NAME`     | -                              | Name of an example transformation input. Multiple examples may be specified.                                                                                                                                                                                     |
| `PATOMAT2_EXAMPLES_ONTOLOGY` | -                              | URL of an example transformation ontology. Multiple examples may be specified.                                                                                                                                                                                   |
| `PATOMAT2_EXAMPLES_PATTERNS` | []                             | List of URLs of example transformation patterns. Multiple examples may be specified.                                                                                                                                                                             |
| `PATOMAT2_LLM_SORT_MAXINSTANCES`  | 10                        | Configure maximum number of pattern instances supported by LLM sorting .                                        |
| `SPRING_AI_OLLAMA_BASEURL`   | -                              | URL of the Ollama LLM service                                                                                   |
| `SPRING_AI_OLLAMA_CHAT_OPTIONS_MODEL` |                       | Name of the LLM model in Ollama to use for LLM calls, e.g. gpt-oss:20b.                                         |

The easiest way to configure them is by creating a `.env` file and setting them there. This file will be automatically
picked by Docker compose.

Note that the `EXAMPLES` as well as `EXAMPLES_PATTERNS` are arrays, so to configure multiple examples (or patterns),
they need to be indexed, for instance:

```properties
PATOMAT2_EXAMPLES_0_NAME=First example name
PATOMAT2_EXAMPLES_0_ONTOLOGY=https://example.com/first-ontology
PATOMAT2_EXAMPLES_0_PATTERNS_0=https://example.com/first-pattern,https://example.com/second-pattern
```

The examples need to be set in the `.env` file or written directly into the `docker-compose.yml` file.

Deployment process is thus as follows:

1. Download/copy the `docker-compose.yml` file and the `nginx` directory.
2. Create the `.env` file and configure the aforementioned parameters as necessary.
3. Start the application by calling `docker compose up -d`.

## Security

The application does not require authentication. However, there is a limit on how many concurrent sessions can be open
at
any given moment. If this limit is reached, any new sessions (i.e., requests from new clients) are rejected until enough
existing sessions time out due to inactivity.

## Documentation

- Documentation for the backend REST API is accessible from each instance in the `About` section, or
  at `${BACKEND_URL}/v3/api-docs`.
- Javadoc for the backend is published via GitHub Pages and is available at https://onto-deside-vse.github.io/patomat2/.

## License

MIT
